using System.Threading;
using Xunit;

namespace Ziusudra.Rencode.Tests
{

    public class StringEncoderTests
    {

        [Theory]
        [InlineData("aasdf", new byte[] { 0x85, 0x61, 0x61, 0x73, 0x64, 0x66 })]
        [InlineData(
            "9ash9f786hjf9ad8fhadf8967hsadf687hasd8f9hdsf8a6gf7h9df67hdhs8f6hsadf876ah5df786asgfdh96fhasdf8967hjasf89h6df7",
            new byte[] { 0x31, 0x30, 0x39, 0x3A, 0x39, 0x61, 0x73, 0x68, 0x39, 0x66, 0x37, 0x38, 0x36, 0x68, 0x6A, 0x66, 0x39,
                0x61, 0x64, 0x38, 0x66, 0x68, 0x61, 0x64, 0x66, 0x38, 0x39, 0x36, 0x37, 0x68, 0x73, 0x61, 0x64, 0x66, 0x36, 0x38,
                0x37, 0x68, 0x61, 0x73, 0x64, 0x38, 0x66, 0x39, 0x68, 0x64, 0x73, 0x66, 0x38, 0x61, 0x36, 0x67, 0x66, 0x37, 0x68,
                0x39, 0x64, 0x66, 0x36, 0x37, 0x68, 0x64, 0x68, 0x73, 0x38, 0x66, 0x36, 0x68, 0x73, 0x61, 0x64, 0x66, 0x38, 0x37,
                0x36, 0x61, 0x68, 0x35, 0x64, 0x66, 0x37, 0x38, 0x36, 0x61, 0x73, 0x67, 0x66, 0x64, 0x68, 0x39, 0x36, 0x66, 0x68,
                0x61, 0x73, 0x64, 0x66, 0x38, 0x39, 0x36, 0x37, 0x68, 0x6A, 0x61, 0x73, 0x66, 0x38, 0x39, 0x68, 0x36, 0x64, 0x66, 0x37 }
        )]
        public async void WriteAsync_ShouldProperlyEncodeAValue(string value, byte[] expected)
        {
            StringEncoder encoder = new();
            FakeMemoryStreamWriter writer = new();

            await encoder.WriteValueAsync(writer, value, CancellationToken.None);

            Assert.Equal(expected, writer.Buffer);
        }
    }
}
